/*! xively-js v1.0.3 | BSD */
var xively=function(e){"use strict";var t,s,a="http://api.xively.com/v2/",n="ws://api.xively.com:8080/",o=!1,r=function(e){if("function"==typeof e)e.apply(this,Array.prototype.slice.call(arguments,1));else if("[object Array]"===Object.prototype.toString.apply(e))for(var t=e.length;t--;)e[t].apply(this,Array.prototype.slice.call(arguments,1))},i=function(e){window.console&&window.console.log&&window.console.log(e)},u=function(s){var a=e.extend({type:"get"},s);if(!t)return i("(xivelyJS) ::: No API key ::: Set your API key first with xively.setKey( YOUR_API_KEY ) before using any methods. Check docs for more info.");if(a.url){if(a.type=a.type.toUpperCase(),"PUT"===a.type||"POST"===a.type){if(!a.data||"object"!=typeof a.data)return;a.data=JSON.stringify(a.data)}e.ajax({url:a.url,type:a.type,headers:{"X-ApiKey":t},data:a.data,crossDomain:!0,dataType:"json",cache:o}).done(a.done).fail(a.fail).always(a.always)}},c={socket:!1,socketReady:!1,queue:[],resources:[]};return c.connect=function(t){window.MozWebSocket&&(window.WebSocket=window.MozWebSocket),!c.socket&&window.WebSocket&&(c.socket=new WebSocket(n),c.socket.onerror=function(e){c.error&&c.error(e,this),c.connect()},c.socket.onclose=function(e){c.close&&c.close(e,this),c.connect()},c.socket.onopen=function(e){c.socketReady=!0,c.open&&c.open(e,this),c.queue.length&&r(c.queue),t&&t(this)},c.socket.onmessage=function(t){var s=t.data,a=JSON.parse(s);a.body&&e("body").trigger("xively."+a.resource,a.body)})},c.subscribe=function(s,a){var n='{"headers":{"X-ApiKey":"'+t+'"}, "method":"subscribe", "resource":"'+s+'"}';return t?(c.resources[s]||(c.resources.push(s),c.socketReady?c.socket.send(n):(c.connect(),c.queue.push(function(){c.socket.send(n)}))),a&&"function"==typeof a&&e(document).on("xively."+s,a),void 0):i("(xivelyJS) ::: No API key ::: Set your API key first with xively.setKey( YOUR_API_KEY ) before using any methods. Check docs for more info.")},c.unsubscribe=function(e){var s='{"headers":{"X-ApiKey":"'+t+'"}, "method":"unsubscribe", "resource":"'+e+'"}';return t?(c.socket&&c.socket.send(s),void 0):i("(xivelyJS) ::: No API key ::: Set your API key first with xively.setKey( YOUR_API_KEY ) before using any methods. Check docs for more info.")},e.ajaxSetup({cache:o}),s={endpoint:a,setEndpoint:function(e){a=e},setWSEndpoint:function(e){n=e},setCache:function(t){t!==o&&(o=t,e.ajaxSetup({cache:o}))},setKey:function(e){t=e},request:function(e){u(e)},subscribe:function(e,t){c.subscribe(e,t)},unsubscribe:function(e){c.unsubscribe(e)},live:function(t,s){var n=function(a,n){var o=a.current_value?a:n;o.current_value&&e(t).each(function(){e(this).html(o.current_value).attr("data-xively-resource",s)})};u({url:a+s.replace(/^\//,""),always:n}),c.subscribe(s,n)},stop:function(t){c.unsubscribe(e(t).first().attr("data-xively-resource"))},feed:{get:function(e,t){u({url:a+"feeds/"+e+".json",always:t})},update:function(e,t,s){u({type:"put",url:a+"feeds/"+e+".json",data:t,always:s})},"new":function(e,t){u({type:"post",url:a+"feeds",data:e,always:t})},"delete":function(e,t){u({type:"delete",url:a+"feeds/"+e,always:t})},history:function(e,t,s){u({url:a+"feeds/"+e+".json",data:t,always:s})},list:function(e,t){u({url:a+"feeds",data:e,always:t})},subscribe:function(e,t){e&&c.subscribe("/feeds/"+e,t)},unsubscribe:function(e){e&&c.unsubscribe("/feeds/"+e)}},datastream:{get:function(e,t,s){u({url:a+"feeds/"+e+"/datastreams/"+t+".json",always:s})},update:function(e,t,s,n){u({type:"put",url:a+"feeds/"+e+"/datastreams/"+t+".json",data:s,always:n})},"new":function(e,t,s){u({type:"post",url:a+"feeds/"+e+"/datastreams",data:t,always:s})},"delete":function(e,t,s){u({type:"delete",url:a+"feeds/"+e+"/datastreams/"+t,always:s})},history:function(e,t,s,n){u({url:a+"feeds/"+e+"/datastreams/"+t+".json",data:s,always:n})},list:function(e,t){u({url:a+"feeds/"+e+".json",always:function(e){t.call(this,e.datastreams)}})},subscribe:function(e,t,s){e&&t&&c.subscribe("/feeds/"+e+"/datastreams/"+t,s)},unsubscribe:function(e,t){e&&t&&c.unsubscribe("/feeds/"+e+"/datastreams/"+t)},live:function(e,t,a){e&&t&&a&&s.live(e,"/feeds/"+t+"/datastreams/"+a)},stop:function(e){e&&s.stop(e)}},datapoint:{get:function(e,t,s,n){u({url:a+"feeds/"+e+"/datastreams/"+t+"/datapoints/"+s,always:n})},update:function(e,t,s,n,o){u({type:"put",url:a+"feeds/"+e+"/datastreams/"+t+"/datapoints/"+s,data:{value:n},always:o})},"new":function(e,t,s,n){u({type:"post",url:a+"feeds/"+e+"/datastreams/"+t+"/datapoints",data:s,always:n})},"delete":function(e,t,s,n){var o={type:"delete",always:n};"object"==typeof s?(o.url=a+"feeds/"+e+"/datastreams/"+t+"/datapoints",o.data=s):o.url=a+"feeds/"+e+"/datastreams/"+t+"/datapoints/"+s,u(o)},history:function(e,t,s,n){u({url:a+"feeds/"+e+"/datastreams/"+t+".json",data:s,always:function(e){n.call(this,e.datapoints)}})}}}}(jQuery);(function(e){"use strict";var t=function(e){return"object"==typeof e?"/feeds/"+e.feed+(e.datastream?"/datastreams/"+e.datastream:""):"string"==typeof e&&""!==e?e:""},s={live:function(e){return xively.live(this,t(e)),this},get:function(s){var a=e(this);return xively.request({url:xively.endpoint+t(s)+".json",always:function(t){a.each(function(){e(this).html(t.current_value)})}}),this}};e.fn.xively=function(t){return s[t]?s[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(e.error("Method "+t+" does not exist on jQuery.tooltip"),void 0):s.init.apply(this,arguments)}})(jQuery);